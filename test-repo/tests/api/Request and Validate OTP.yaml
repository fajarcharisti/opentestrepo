description: Test the API request OTP and validate OTP endpoints
actors:
  - actor: ACTOR1
    segments:
      - segment: 1
        actions:
          - description: |
              Request an OTP code
            action: org.getopentest.actions.HttpRequest
            args:
              url: https://api-sqeid.dev.squantumengine.com/v1/cosmos/otp/request
              verb: POST
              headers:
                Content-Type: application/json
              body:
                client_id: "groot"
                client_secret_key: "F7Z3XOoYcVcW1Rw3fKPvFzVVE86SRqE8"
                user_id: "harisfajartiga@gmail.com"
              validate:
                - assert:
                    that: response.statusCode
                    isEqualTo: 200
                - script: |
                    var otpCode = JSON.parse(response.body).otp;
                    test.setVariable("otpCode", otpCode);

          - description: |
              Validate the OTP code
            action: org.getopentest.actions.HttpRequest
            args:
              url: https://api-sqeid.dev.squantumengine.com/v1/cosmos/otp/validate
              verb: POST
              headers:
                Content-Type: application/json
              body:
                client_id: "groot"
                client_secret_key: "F7Z3XOoYcVcW1Rw3fKPvFzVVE86SRqE8"
                user_id: "harisfajartiga@gmail.com"
                otp: ${test.getVariable("otpCode")}
              validate:
                - assert:
                    that: response.statusCode
                    isEqualTo: 200
            